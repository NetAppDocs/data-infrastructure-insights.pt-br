---
sidebar: sidebar 
permalink: task_install_manual_au.html 
keywords: Acquisition Unit, AU, install, configure, Linux, add, remove, uninstall, delete, deleting, move, moving, manual, AU, Patch 
summary: O Data Infrastructure Insights pode ser configurado para que o software AU seja atualizado manualmente, proporcionando mais controle sobre o software instalado no seu locatário. 
---
= Instalando manualmente o software da unidade de aquisição
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Por padrão, o Data Infrastructure Insights atualiza o software da Unidade de Aquisição (AU) automaticamente conforme as atualizações são implantadas.  Entretanto, em ambientes controlados e seguros, a atualização automática pode não ser possível ou desejada.  Nesses casos, o Data Infrastructure Insights pode ser configurado para que o software AU seja atualizado manualmente, proporcionando mais controle sobre o software instalado no seu locatário.

Para baixar e instalar manualmente o software AU, execute as seguintes etapas.  O Data Infrastructure Insights fornece uma página de documentação útil do Swagger que você pode usar para muitas dessas etapas, ou você pode usar seu próprio script/comandos de API.  Vá para Admin > Acesso à API e clique no link “Documentação da API”.

O processo é semelhante para Linux e Windows.



== Executando uma NOVA instalação de AU no Linux:

. No Data Infrastructure Insights, crie um token de API.
+
.. Navegue até *Admin > Acesso à API* e selecione *+Token de acesso à API*.
+
... Defina um *Nome* e uma *Descrição* que sejam fáceis de identificar
... Tipo: Escolha *Unidade de Aquisição* e *Coleta de Dados*
... Permissões: *Leitura/Escrita*
... Selecione os valores desejados de *Expiração* e *Renovação Automática*


.. Clique em *Salvar*
.. Copie o token de acesso à API gerado.  Esta etapa deve ser executada antes que você possa fechar a janela.




image:Manual_AU_Create_API_Token.png["Criar Token de API"]

. No Swagger (Admin > Acesso à API > Documentação da API), use o token para autorizar APIs do Data Infrastructure Insights
+
.. Clique em _Autorizar_ no canto superior direito da tela do Swagger
.. Cole o token copiado acima no campo Customer APIKey
.. Clique em *Autorizar*
.. Fechar a janela




image:Manual_AU_Authorization.png["Autorizar o token da API"]

. Baixe o instalador AU usando a API _/au/installers/{platform}/latest_ ou _/au/installers/{platform}/{version}_:
+
.. Plataforma: *linux*
.. Versão: *<versão>* (mais recente ou especificada)




image:Manual_AU_API_Retrieve_latest.png["API para recuperar a versão mais recente da AU"]


NOTE: Se você não estiver baixando a versão mais recente, confirme com a NetApp a versão AU a ser especificada para download.

. Clique em *Baixar arquivo*.  Se você estiver executando essas etapas em um sistema diferente do sistema AU, copie o arquivo baixado para o sistema AU.
. Como alternativa, você pode executar o comando CURL resultante no sistema AU:
+
 curl -X GET "<tenant>/rest/v1/au/installers/linux/<AU version>" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <token>"
. Neste ponto, o arquivo do instalador deve estar presente no sistema AU.



IMPORTANT: Os próximos passos exigem o uso de um token temporário.  Não use o token de acesso à API que você criou acima.

. No Data Infrastructure Insights API Swagger, crie um token único usando a API _/au/oneTimeToken_.
+
.. Copie o token de uso único resultante.




image:Manual_AU_one_time_token.png["Criar token de API de uso único"] image:Manual_AU_one_time_token_response.png["Resposta para exemplo de token de API de uso único"]

. Na máquina onde o AU será instalado, navegue até a pasta que contém o arquivo do instalador baixado.  Os comandos abaixo exigem que o usuário tenha permissões de root.
+
.. Descompacte o arquivo do instalador
.. Mude o diretório para a pasta do instalador resultante
.. Exporte o token único e a versão do instalador para variáveis de ambiente executando o seguinte:
+
 export TOKEN=<One-Time Token>
.. Execute o seguinte para instalar o CI com um usuário e grupo personalizados:
+
 ./cloudinsights-install.sh <custom user> <custom group>
+
Observação: se não desejar usar um usuário e grupo personalizados, você pode usar o usuário e grupo padrão “cisys”.  Nesse caso, execute o comando de instalação acima, mas não especifique o usuário e o grupo.





Neste ponto, o software AU é instalado no sistema e pode ser acessado pelo usuário e grupo personalizados.  Entretanto, você não tem a capacidade de adicionar coletores de dados.  Para fazer isso manualmente, leia as instruções a seguir.  Se você deseja apenas instalar um patch, consulte o<<downloading-a-patch,Correção>> seção abaixo.



== Instalando manualmente coletores de dados

Baixe o arquivo datasources.war mais recente usando a API /collector/patch/datasourceswar/latest:

image:API_Manual_Download_datasources.png["API para recuperar os últimos datasources.war"]

Observação: se você não estiver baixando a versão mais recente, confirme com a NetApp a versão a ser especificada para download.

Clique em Baixar arquivo.  Se você estiver executando essas etapas em um sistema diferente do sistema AU, copie o pacote zip datasources.war baixado para o sistema AU.

Certifique-se de que o pacote zip datasources.war seja copiado para o seguinte diretório: /var/lib/netapp/cloudinsights/acq/download

Navegue até o diretório /var/lib/netapp/cloudinsights/acq/download para datasources.war e verifique o arquivo zip lá:

. Você deve alternar para (ou sair do root e efetuar login com) o usuário personalizado para as próximas etapas.
+
 su <custom user>
+
Observação: se você estiver usando o usuário e o grupo padrão “cisys”, não será necessário executar esta etapa.

+
Observação: o usuário personalizado pode ser qualquer usuário que seja membro de um grupo personalizado que você forneceu ao cloudinsights-install.sh durante a instalação do AU e pode ser o mesmo ou diferente do usuário personalizado que você forneceu durante a instalação do AU.

. Execute o seguinte:
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/datasources-war-<version>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 datasources-war-<version>.zip
…
....
+
Observação: se estiver usando o usuário e o grupo “cisys”, eles serão exibidos na saída acima.

+
Observação: se você planeja instalar usando diferentes usuários personalizados, certifique-se de que as permissões de grupo estejam definidas para leitura e gravação para o proprietário e o grupo (chmod 660 …)

. Reinicie a AU. No Data Infrastructure Insights, navegue até Observabilidade > Coletores e selecione a guia Unidades de Aquisição.  Selecione Reiniciar no menu de “três pontos” à direita da UA.




== Baixando um Patch

Baixe o patch usando a API /collector/patch/file/{version}:

image:API_Manual_Download_patch.png["API para recuperar patch"]

Observação: confirme com a NetApp a versão a ser especificada para download.

Clique em Baixar arquivo.  Se você estiver executando essas etapas em um sistema diferente do sistema AU, copie o pacote zip do patch baixado para o sistema AU.

Certifique-se de que o pacote zip do patch seja copiado para o seguinte diretório: /var/lib/netapp/cloudinsights/acq/download

Navegue até o diretório /var/lib/netapp/cloudinsights/acq/download para o patch e verifique o arquivo .zip lá:

. Você deve alternar para (ou sair do root e efetuar login com) o usuário personalizado para as próximas etapas.
+
 su <custom user>
+
Observação: se você estiver usando o usuário e o grupo padrão “cisys”, não será necessário executar esta etapa.

+
Observação: o usuário personalizado pode ser qualquer usuário que seja membro de um grupo personalizado que você forneceu ao cloudinsights-install.sh durante a instalação do AU e pode ser o mesmo ou diferente do usuário personalizado que você forneceu durante a instalação do AU.

. Execute o seguinte:
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/<patch_file_name>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 <patch_file_name>.zip
…
....
+
Observação: se estiver usando o usuário e o grupo “cisys”, eles serão exibidos na saída acima.

+
Observação: se você planeja instalar usando diferentes usuários personalizados, certifique-se de que as permissões de grupo estejam definidas para leitura e gravação para o proprietário e o grupo (chmod 660 …)

. Reinicie a AU. No Data Infrastructure Insights, navegue até Observabilidade > Coletores e selecione a guia Unidades de Aquisição.  Selecione Reiniciar no menu de “três pontos” à direita da UA.




== Recuperação de Chave Externa

Se você fornecer um script de shell UNIX, ele poderá ser executado pela unidade de aquisição para recuperar a *chave privada* e a *chave pública* do seu sistema de gerenciamento de chaves.

Para recuperar a chave, o Data Infrastructure Insights executará o script, passando dois parâmetros: _key id_ e _key type_.  _ID da chave_ pode ser usado para identificar a chave no seu sistema de gerenciamento de chaves.  O _Tipo de chave_ é "público" ou "privado".  Quando o tipo de chave é "pública", o script deve retornar a chave pública.  Quando o tipo de chave é "privada", a chave privada deve ser retornada.

Para enviar a chave de volta para a unidade de aquisição, o script deve imprimir a chave na saída padrão.  O script deve imprimir _apenas_ a chave na saída padrão; nenhum outro texto deve ser impresso na saída padrão.  Depois que a chave solicitada for impressa na saída padrão, o script deverá sair com um código de saída 0; qualquer outro código de retorno será considerado um erro.

O script deve ser registrado na unidade de aquisição usando a ferramenta SecurityAdmin, que executará o script junto com a unidade de aquisição.  O script deve ter permissão de _leitura_ e _execução_ para o usuário root e "cisys".  Se o script de shell for modificado após o registro, o script de shell modificado deverá ser registrado novamente na unidade de aquisição.

|===


| parâmetro de entrada: id da chave | Identificador de chave usado para identificar a chave no sistema de gerenciamento de chaves do cliente. 


| parâmetro de entrada: tipo de chave | público ou privado. 


| saída | A chave solicitada deve ser impressa na saída padrão.  A chave RSA de 2048 bits é suportada atualmente.  As chaves devem ser codificadas e impressas no seguinte formato: formato de chave privada - PEM, codificado em DER PKCS8 PrivateKeyInfo RFC 5958 formato de chave pública - PEM, codificado em DER X.509 SubjectPublicKeyInfo RFC 5280 


| código de saída | Código de saída zero para sucesso.  Todos os outros valores de saída são considerados falha. 


| permissões de script | O script deve ter permissão de leitura e execução para o usuário root e "cisys". 


| toras | As execuções de script são registradas.  Os logs podem ser encontrados em - /var/log/netapp/cloudinsights/securityadmin/securityadmin.log /var/log/netapp/cloudinsights/acq/acq.log 
|===