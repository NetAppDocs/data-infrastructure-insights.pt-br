---
sidebar: sidebar 
permalink: task_config_telegraf_agent.html 
keywords: telegraf, agent, telegraf agent 
summary: O Data Infrastructure Insights oferece suporte ao Telegraf como seu agente para coleta de dados de integração e pode ser configurado no Windows ou Linux. 
---
= Configurando um agente para coletar dados (Windows/Linux)
:hardbreaks:
:allow-uri-read: 


[role="lead"]
O Data Infrastructure Insights usalink:https://docs.influxdata.com/telegraf["Telégrafo"] como seu agente para coleta de dados de integração. O Telegraf é um agente de servidor controlado por plugin que pode ser usado para coletar e relatar métricas, eventos e logs.  Os plugins de entrada são usados ​​para coletar as informações desejadas no agente acessando o sistema/SO diretamente, chamando APIs de terceiros ou ouvindo fluxos configurados (por exemplo, Kafka, statsD, etc.).  Os plugins de saída são usados ​​para enviar as métricas, eventos e logs coletados do agente para o Data Infrastructure Insights.

Para obter informações sobre a instalação no Kubernetes, consulte olink:task_config_telegraf_agent_k8s.html["Operador de monitoramento do NetApp Kubernetes"] página.


NOTE: Para auditoria e relatórios de dados precisos, é altamente recomendável sincronizar o horário na máquina do agente usando *Network Time Protocol (NTP)* ou *Simple Network Time Protocol (SNTP)*.


NOTE: Se você quiser verificar os arquivos de instalação antes de instalar o Agente, consulte a seção abaixo sobre<<Verificando somas de verificação de pacotes Telegraf>> .



== Instalando um Agente

Se você estiver instalando um coletor de dados de serviço e ainda não tiver configurado um agente, será solicitado que você primeiro instale um agente para o sistema operacional apropriado.  Este tópico fornece instruções para instalar o agente Telegraf nos seguintes sistemas operacionais:

* <<Windows>>
* <<RHEL e CentOS>>
* <<Ubuntu e Debian>>


Para instalar um agente, independentemente da plataforma que você estiver usando, você deve primeiro fazer o seguinte:

. Efetue login no host que você usará para seu agente.
. Efetue login no seu ambiente do Data Infrastructure Insights e navegue até *Observabilidade > Coletores*.
. Clique em *+Data Collector* e escolha um coletor de dados para instalar.
. Escolha a plataforma apropriada para seu host (Windows, Linux)
. Siga os passos restantes para cada plataforma.



NOTE: Depois de instalar um agente em um host, você não precisa instalá-lo novamente nesse host.


TIP: Depois de instalar um agente em um servidor/VM, o Data Infrastructure Insights coleta métricas desse sistema, além de coletar dados de quaisquer coletores de dados que você configurar.  Essas métricas são coletadas comolink:task_config_telegraf_node.html["Métricas de "nó""] .


NOTE: Se você estiver usando um proxy, leia as instruções do proxy para sua plataforma antes de instalar o agente Telegraf.



=== Locais de registro

As mensagens de log do Telegraf são redirecionadas do stdout para os seguintes arquivos de log por padrão:

* RHEL/CentOS: /var/log/telegraf/telegraf.log
* Ubuntu/Debian: /var/log/telegraf/telegraf.log
* Windows: C:\Arquivos de Programas\telegraf\telegraf.log




=== Windows



==== Pré-requisitos:

* O PowerShell deve ser instalado
* Se você estiver atrás de um proxy, siga as instruções na seção *Configurando o suporte a proxy para Windows*.




==== Configurando o suporte a proxy para Windows


NOTE: Se o seu ambiente usa um proxy, leia esta seção antes de instalar.


NOTE: As etapas abaixo descrevem as ações necessárias para definir as variáveis de ambiente _http_proxy/https_proxy_.  Para alguns ambientes de proxy, os usuários também podem precisar definir a variável de ambiente _no_proxy_.

Para sistemas que residem atrás de um proxy, execute o seguinte para definir as variáveis de ambiente _https_proxy_ e/ou _http_proxy_ *ANTES* de instalar o agente Telegraf:

 [System.Environment]:SetEnvironmentVariable(“https_proxy”, “<proxy_server>:<proxy_port>”, [System.EnvironmentVariableTarget]:Machine)


==== Instalando o agente

image:AgentInstallWindows.png["Instalação do agente do Windows"]

.Etapas para instalar o agente no Windows:
. Escolha uma chave de acesso do agente.
. Copie o bloco de comando da caixa de diálogo de instalação do agente.  Você pode clicar no ícone da área de transferência para copiar rapidamente o comando para a área de transferência.
. Abra uma janela do PowerShell
. Cole o comando na janela do PowerShell e pressione Enter.
. O comando baixará o instalador do agente apropriado, instalará-o e definirá uma configuração padrão.  Quando terminar, o serviço do agente será reiniciado.  O comando tem uma chave única e é válido por 24 horas.
. Clique em *Concluir* ou *Continuar*


Após a instalação do agente, você pode usar os seguintes comandos para iniciar/parar o serviço:

....
Start-Service telegraf
Stop-Service telegraf
....


==== Desinstalando o Agente

Para desinstalar o agente no Windows, faça o seguinte em uma janela do PowerShell:

. Pare e exclua o serviço Telegraf:
+
....
Stop-Service telegraf
sc.exe delete telegraf
....
. Remova o certificado do truststore:
+
....
cd Cert:\CurrentUser\Root
//rm E5FB7B68C08B1CA902708584C274F8EFC7BE8ABC
rm 1A918038E8E127BB5C87A202DF173B97A05B4996
....
. Exclua a pasta _C:\Program Files\telegraf_ para remover os arquivos binários, de log e de configuração
. Remova a chave _SYSTEM\CurrentControlSet\Services\EventLog\Application\telegraf_ do registro




==== Atualizando o Agente

Para atualizar o agente Telegraf, faça o seguinte:

. Pare e exclua o serviço telegraf:
+
....
Stop-Service telegraf
sc.exe delete telegraf
....
. Exclua a chave _SYSTEM\CurrentControlSet\Services\EventLog\Application\telegraf_ do registro
. Excluir _C:\Arquivos de Programas\telegraf\telegraf.conf_
. Excluir _C:\Arquivos de Programas\telegraf\telegraf.exe_
. link:#windows["Instalar o novo agente"] .




=== RHEL e CentOS



==== Pré-requisitos:

* Os seguintes comandos devem estar disponíveis: curl, sudo, ping, sha256sum, openssl e dmidecode
* Se você estiver atrás de um proxy, siga as instruções na seção *Configurando o suporte a proxy para RHEL/CentOS*.




==== Configurando o suporte de proxy para RHEL/CentOS


NOTE: Se o seu ambiente usa um proxy, leia esta seção antes de instalar.


NOTE: As etapas abaixo descrevem as ações necessárias para definir as variáveis de ambiente _http_proxy/https_proxy_.  Para alguns ambientes de proxy, os usuários também podem precisar definir a variável de ambiente _no_proxy_.

Para sistemas que residem atrás de um proxy, execute as seguintes etapas *ANTES* de instalar o agente Telegraf:

. Defina as variáveis de ambiente _https_proxy_ e/ou _http_proxy_ para o usuário atual:
+
 export https_proxy=<proxy_server>:<proxy_port>
. Crie _/etc/default/telegraf_ e insira definições para as variáveis _https_proxy_ e/ou _http_proxy_:
+
 https_proxy=<proxy_server>:<proxy_port>




==== Instalando o agente

image:Agent_Requirements_Rhel.png["Instalação do agente Rhel/CentOS"]

.Etapas para instalar o agente no RHEL/CentOS:
. Escolha uma chave de acesso do agente.
. Copie o bloco de comando da caixa de diálogo de instalação do agente.  Você pode clicar no ícone da área de transferência para copiar rapidamente o comando para a área de transferência.
. Abra uma janela Bash
. Cole o comando na janela do Bash e pressione Enter.
. O comando baixará o instalador do agente apropriado, instalará-o e definirá uma configuração padrão.  Quando terminar, o serviço do agente será reiniciado.  O comando tem uma chave única e é válido por 24 horas.
. Clique em *Concluir* ou *Continuar*


Após a instalação do agente, você pode usar os seguintes comandos para iniciar/parar o serviço:

Se o seu sistema operacional estiver usando systemd (CentOS 7+ e RHEL 7+):

....
sudo systemctl start telegraf
sudo systemctl stop telegraf
....
Se o seu sistema operacional não estiver usando o systemd (CentOS 7+ e RHEL 7+):

....
sudo service telegraf start
sudo service telegraf stop
....


==== Desinstalando o Agente

Para desinstalar o agente no RHEL/CentOS, em um terminal Bash, faça o seguinte:

. Pare o serviço Telegraf:
+
....
systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. Remova o agente Telegraf:
+
 yum remove telegraf
. Remova quaisquer arquivos de configuração ou log que possam ter sido deixados para trás:
+
....
rm -rf /etc/telegraf*
rm -rf /var/log/telegraf*
....




==== Atualizando o Agente

Para atualizar o agente Telegraf, faça o seguinte:

. Pare o serviço de telégrafo:
+
....
systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. Remova o agente telegráfico anterior:
+
 yum remove telegraf
. link:#rhel-and-centos["Instalar o novo agente"] .




=== Ubuntu e Debian



==== Pré-requisitos:

* Os seguintes comandos devem estar disponíveis: curl, sudo, ping, sha256sum, openssl e dmidecode
* Se você estiver atrás de um proxy, siga as instruções na seção *Configurando o suporte a proxy para Ubuntu/Debian*.




==== Configurando o suporte a proxy para Ubuntu/Debian


NOTE: Se o seu ambiente usa um proxy, leia esta seção antes de instalar.


NOTE: As etapas abaixo descrevem as ações necessárias para definir as variáveis de ambiente _http_proxy/https_proxy_.  Para alguns ambientes de proxy, os usuários também podem precisar definir a variável de ambiente _no_proxy_.

Para sistemas que residem atrás de um proxy, execute as seguintes etapas *ANTES* de instalar o agente Telegraf:

. Defina as variáveis de ambiente _https_proxy_ e/ou _http_proxy_ para o usuário atual:
+
 export https_proxy=<proxy_server>:<proxy_port>
. Crie /etc/default/telegraf e insira definições para as variáveis _https_proxy_ e/ou _http_proxy_:
+
 https_proxy=<proxy_server>:<proxy_port>




==== Instalando o agente

image:Agent_Requirements_Ubuntu.png["Instalação do agente Ubuntu/Debian"]

.Etapas para instalar o agente no Debian ou Ubuntu:
. Escolha uma chave de acesso do agente.
. Copie o bloco de comando da caixa de diálogo de instalação do agente.  Você pode clicar no ícone da área de transferência para copiar rapidamente o comando para a área de transferência.
. Abra uma janela Bash
. Cole o comando na janela do Bash e pressione Enter.
. O comando baixará o instalador do agente apropriado, instalará-o e definirá uma configuração padrão.  Quando terminar, o serviço do agente será reiniciado.  O comando tem uma chave única e é válido por 24 horas.
. Clique em *Concluir* ou *Continuar*


Após a instalação do agente, você pode usar os seguintes comandos para iniciar/parar o serviço:

Se o seu sistema operacional estiver usando systemd:

....
sudo systemctl start telegraf
sudo systemctl stop telegraf
....
Se o seu sistema operacional não estiver usando systemd:

....
sudo service telegraf start
sudo service telegraf stop
....


==== Desinstalando o Agente

Para desinstalar o agente no Ubuntu/Debian, em um terminal Bash, execute o seguinte:

. Pare o serviço Telegraf:
+
....
systemctl stop telegraf (If your operating system is using systemd)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. Remova o agente Telegraf:
+
 dpkg -r telegraf
. Remova quaisquer arquivos de configuração ou log que possam ter sido deixados para trás:
+
....
rm -rf /etc/telegraf*
rm -rf /var/log/telegraf*
....




==== Atualizando o Agente

Para atualizar o agente Telegraf, faça o seguinte:

. Pare o serviço de telégrafo:
+
....
systemctl stop telegraf (If your operating system is using systemd)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. Remova o agente telegráfico anterior:
+
 dpkg -r telegraf
. link:#ubuntu-and-debian["Instalar o novo agente"] .




== Verificando somas de verificação de pacotes Telegraf

O instalador do agente do Data Infrastructure Insights executa verificações de integridade, mas alguns usuários podem querer realizar suas próprias verificações antes de instalar o binário do Telegraf baixado.  Isso pode ser feito baixando o instalador e gerando uma soma de verificação para o pacote baixado e, em seguida, comparando a soma de verificação com o valor mostrado nas instruções de instalação.



=== Baixe o pacote de instalação sem instalar

Para executar uma operação somente de download (em oposição ao download e instalação padrão), os usuários podem editar o comando de instalação do agente obtido na interface do usuário e remover a opção “instalar”.

Siga estes passos:

. Copie o snippet do instalador do agente conforme as instruções.
. Em vez de colar o snippet em uma janela de comando, cole-o em um editor de texto.
. Remova o final “--install” (Linux) ou “-install” (Windows) do comando.
. Copie o comando inteiro do editor de texto.
. Agora cole-o na sua janela de comando (em um diretório de trabalho) e execute-o.


Não Windows (esses exemplos são para Kubernetes; os nomes reais dos scripts podem variar):

* Baixar e instalar (padrão):
+
 installerName=cloudinsights-ubuntu_debian.sh … && ./$installerName --download --verify && sudo -E -H ./$installerName --install
* Somente para download:
+
 installerName=cloudinsights-ubuntu_debian.sh … && ./$installerName --download --verify


Windows:

* Baixar e instalar (padrão):
+
 !$($installerName=".\cloudinsights-windows.ps1") … -and $(if(((Get-FileHash $installerName).Hash).ToLower() -eq "INSTALLER_CHECKSUM ") { &$installerName -download -verify -install } else { Write-Host "Install script checksum does not match"})"
* Somente para download:
+
 !$($installerName=".\cloudinsights-windows.ps1") … -and $(if(((Get-FileHash $installerName).Hash).ToLower() -eq "INSTALLER_CHECKSUM ") { &$installerName -download -verify } else { Write-Host "Install script checksum does not match"})"


O comando somente download baixará todos os artefatos necessários do Data Infrastructure Insights para o diretório de trabalho.  Os artefatos incluem, mas não estão limitados a:

* um script de instalação
* um arquivo de ambiente
* um binário Telegraf
* uma assinatura para o binário Telegraf
* um certificado público para verificar a assinatura binária


O snippet de instalação baixado e copiado do DII verifica automaticamente o script de instalação, e a assinatura do binário do telegraf é verificada pelo script de instalação.



=== Verificar valor de soma de verificação

Para gerar o valor da soma de verificação, execute o seguinte comando para sua plataforma apropriada:

* RHEL/Ubuntu:
+
 sha256sum <package_name>
* Windows:
+
 Get-FileHash telegraf.zip -Algorithm SHA256 | Format-List




=== Instale o pacote baixado

Depois que todos os artefatos forem verificados satisfatoriamente, a instalação do agente pode ser iniciada executando:

Não Windows:

 sudo -E -H ./<installation_script_name> --install
Windows:

 .\cloudinsights-windows.ps1 -install


== Criação e uso de tokens de acesso à API

Para criar um token de acesso à API para ingestão de dados do Telegraf, siga um destes procedimentos:



=== Criar através da página de instalação do coletor de dados

. Navegue até a página de instalação do Data Collector para a plataforma que você deseja usar (Windows, Linux).
. Crie um token com o botão + Token de acesso à API.
. Insira um nome e clique em salvar.
. O nome do token agora deve ser selecionado no menu suspenso e será usado ao instalar o coletor.




=== Crie manualmente um token de acesso à API

. Navegue até Admin > Acesso à API.
. Clique em + Token de acesso à API.
. Insira um nome e, opcionalmente, uma descrição.
. Em “Que tipo de APIs este token será usado para chamar?”, selecione apenas “Ingestão de dados” e depois desmarque “Unidade de aquisição”.
. Em “Permissões”, selecione Leitura/Gravação.
. Desmarque “Girar tokens automaticamente para Kubernetes”.


Para usar seu token de acesso à API recém-criado, selecione-o no menu suspenso “Selecionar token de acesso à API existente ou criar um novo” na página do instalador.  Observe que somente tokens com as seguintes propriedades podem ser usados:

* Tipo de API: somente “Ingestão de dados”
* Permissões: Leitura/Escrita
* Rotação automática do Kubernetes: Desativado




== Solução de problemas

Algumas coisas que você pode tentar se tiver problemas ao configurar um agente:

[cols="2*"]
|===
| Problema: | Experimente isto: 


| Após configurar um novo plugin e reiniciar o Telegraf, o Telegraf não inicia.  Os logs indicam um erro semelhante ao seguinte: "[telegraf] Erro ao executar o agente: Erro ao carregar o arquivo de configuração /etc/telegraf/telegraf.d/cloudinsights-default.conf: plugin outputs.http: linha <número da linha>: a configuração especificou os campos ["use_system_proxy"], mas eles não foram usados" | A versão instalada do Telegraf está desatualizada.  Siga as etapas nesta página para *Atualizar o Agente* para sua plataforma apropriada. 


| Executei o script do instalador em uma instalação antiga e agora o agente não está enviando dados | Desinstale o agente Telegraf e execute novamente o script de instalação.  Siga as etapas de *Atualizar o Agente* nesta página para sua plataforma apropriada. 


| Já instalei um agente usando o Data Infrastructure Insights | Se você já instalou um agente no seu host/VM, não precisa instalá-lo novamente.  Nesse caso, basta escolher a plataforma e a chave apropriadas na tela de instalação do agente e clicar em *Continuar* ou *Concluir*. 


| Já tenho um agente instalado, mas não usando o instalador do Data Infrastructure Insights | Remova o agente anterior e execute a instalação do Data Infrastructure Insights Agent para garantir as configurações corretas do arquivo de configuração padrão.  Quando terminar, clique em *Continuar* ou *Concluir*. 
|===
Informações adicionais podem ser encontradas emlink:concept_requesting_support.html["Apoiar"] página ou nolink:reference_data_collector_support_matrix.html["Matriz de Suporte ao Coletor de Dados"] .
