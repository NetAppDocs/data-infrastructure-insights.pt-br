---
sidebar: sidebar 
permalink: ws_manually_installing_agent_and_collector.html 
keywords: install, configure, agent, collector, workload, security, cloud secure 
summary: Os agentes de segurança de carga de trabalho podem ser instalados ou atualizados manualmente, proporcionando mais controle sobre o software instalado no seu locatário. 
---
= Instalando manualmente o agente e o coletor de segurança de carga de trabalho
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Por padrão, quando uma nova versão de um agente ou coletor do Workload Security está disponível, uma notificação de pré-atualização é enviada, e os agentes e coletores são atualizados automaticamente no seu locatário.  Entretanto, em um ambiente controlado e seguro, atualizações automáticas podem não ser desejáveis.  Nesses casos, o Workload Security pode ser configurado para instalação/atualização manual de agentes e coletores, proporcionando mais controle sobre o software instalado em seus sistemas.



== Antes de começar

. Verifique no swagger se as categorias de API denominadas “cloudsecure_installers.agent” e “cloudsecure_installers.collector” estão disponíveis.  Caso contrário, o suporte para instalação manual do agente não será habilitado.  Entre em contato com o suporte da NetApp para habilitar o recurso.
+
image:ws_manual_install_APIs.png["APIs de instalação manual"]

. Execute todos os comandos mencionados neste documento como usuário 'root' ou, se estiver executando com um usuário diferente, execute os comandos com 'sudo'.




== Instalando um novo agente

. Crie um novo token de acesso à API de segurança de carga de trabalho.
+
.. Navegue até *Admin > Acesso à API*.  Selecione a aba “Tokens de Segurança de Carga de Trabalho” e clique em “+ Token de Acesso à API”.
+
... Defina um Nome e uma Descrição que sejam fáceis de identificar.
... No menu suspenso “Que tipo de APIs este token será usado para chamar?”, selecione _Gerenciamento de coletores_ e _Instalação de agente e coletor_.
... Selecione a duração de expiração desejada.


.. Clique em _Salvar_.




[[copy-access-token]]
. Copie o token de acesso da API gerado.  Observe que, depois que a janela for fechada, o token não poderá mais ser recuperado.  Nesse caso, você precisará gerar um novo token.
+
image:ws_create_and_save_token.png["Criar e salvar token de API"]

+
image:ws_create_and_save_token_confirm.png["Confirme a criação do token"]

+
.. Navegue até *Admin > Acesso à API > Documentação da API* (canto superior direito da página) e selecione o ícone _Segurança da carga de trabalho_.  Isso abre a documentação do Swagger para APIs de segurança de carga de trabalho.
+
image:ws_swagger_documentation_link.png["Documentação do Swagger para Segurança de Carga de Trabalho"]

.. Autorizar o acesso às APIs de _Segurança de Carga de Trabalho_.


. Clique no botão _Autorizar_ no canto superior direito da página.
. No campo de texto _Customer ApiKey (apiKey)_, cole o token de API copiado anteriormente de<<copy-access-token,Etapa 1c>> .
. Clique em _Autorizar_ e feche a janela.
+
image:ws_API_authorization.png["Autorizar a API"]

+
.. Baixe o instalador do agente.


. No Swagger, selecione _cloudsecure_installers.agent_ > _/v1/cloudsecure/agents/installers/{platform}/latest_ (GET) API.  Clique em _Experimentar_.
. No campo _plataforma_, digite _linux_.  Clique em _Executar_.
+
image:ws_installers_agent_api_swagger.png["Swagger para API do instalador de agentes - topo"] image:ws_installers_agent_api_swagger-2.png["Swagger para API do instalador do agente - resposta"]

. Clique em "Baixar arquivo" para baixar o instalador.
. Se o arquivo do instalador for baixado externamente em uma máquina diferente do sistema onde o agente será instalado, copie o arquivo do instalador para esse sistema.
. Como alternativa, você pode copiar o comando curl e executá-lo diretamente no sistema onde o agente deve ser instalado.
+
** Adicione o argumento “-o {{file_name}}” ao comando curl para salvar o arquivo do instalador com o nome desejado.  O nome real do arquivo do instalador pode ser encontrado na seção de cabeçalhos de resposta do swagger.  Esse nome também pode ser usado.
+
image:ws_installers_agent_api_swagger_installer_file.png["Escolhendo o agente mais recente via API - Swagger"]

** Embora o arquivo possa ser baixado para qualquer local, é recomendável baixá-lo para uma pasta vazia na qual o instalador .zip possa ser extraído.
+
... Crie uma nova pasta (recomendado), copie o arquivo do instalador para esta pasta e descompacte:
+
[listing]
----
[root@demo-agent /]# mkdir agent_installers
[root@demo-agent /]# cd agent_installers/
[root@demo-agent agent_installers]# pwd
/agent_installers
[root@demo-agent agent_installers]# ll
total 0
[root@demo-agent agent_installers]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/agents/installers/linux/latest" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cloudsecure-linux-agent-installer-1.617.0.zip
[root@demo-agent agent_installers]# ll
total 76012
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip
----
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.617.0.zip
Archive:  cloudsecure-linux-agent-installer-1.617.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
----
... Defina a permissão _execute_ para o arquivo “cloudsecure-agent-install.sh”.
+
[listing]
----
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-install.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154250 Apr 26 06:37 cloudsecure-agent-image.zip
-rwx------ 1 root root    16574 Apr 26 06:25 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26 06:25 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip

----
... Gere um token único para instalação de novo agente.
+
Observação: o token único gerado nesta etapa é diferente do token de acesso à API gerado em<<copy-access-token,Etapa 1c>> .





. No Swagger, execute _cloudsecure_installers.agent > /v1/cloudsecure/agent/oneTimeToken_ API e copie o token da resposta.
+
.. Exporte o token único como uma variável de ambiente.
+
[listing]
----
[root@demo-agent ~]# export TOKEN=<<one time token generated in step 7>>
----
.. Se um servidor proxy for usado, exporte https_proxy como uma variável de ambiente no formato mencionado abaixo.
+
[listing]
----
[root@demo-agent ~]# export HTTPS_PROXY='USER:PASSWORD@PROXY_SERVER:PORT'
----
.. Opcional: Por padrão, o agente e os coletores serão instalados no caminho “/opt/netapp”.  Para instalar em um caminho diferente, defina a seguinte variável de ambiente:
+
[listing]
----
[root@demo-agent ~]# export AGENT_INSTALL_PATH=/test_user/apps
----
+
Observação: se instalado em um caminho personalizado, os coletores de dados e todos os outros artefatos, como logs de agentes, serão criados somente dentro do caminho personalizado.  Os logs de instalação ainda estarão presentes em - _/var/log/netapp/cloudsecure/install_.

.. Volte para o diretório onde o instalador do agente foi baixado e execute “cloudsecure-agent-install.sh”
+
[listing]
----
[root@demo-agent agent_installers]# ./ cloudsecure-agent-install.sh
----
+
Observação: se o usuário não estiver executando em um shell “bash”, o comando export pode não funcionar.  Nesse caso, as etapas 8 a 11 podem ser combinadas e executadas conforme abaixo.  HTTPS_PROXY e AGENT_INSTALL_PATH são opcionais e podem ser ignorados se não forem necessários.

+
[listing]
----
sudo /bin/bash -c "TOKEN=<<one time token generated in step 7>> HTTPS_PROXY=<<proxy details in the format mentioned in step 9>> AGENT_INSTALL_PATH=<<custom_path_to_install_agent>> ./cloudsecure-agent-install.sh"
----
+
Neste ponto, o agente deve ser instalado com sucesso.

.. Verificação de integridade para instalação do agente:


. Execute “systemctl status cloudsecure-agent.service” e verifique se o serviço do agente está no estado _em execução_.
+
[listing]
----
[root@demo-agent ~]# systemctl status cloudsecure-agent.service
 cloudsecure-agent.service - Cloud Secure Agent Daemon Service
   Loaded: loaded (/usr/lib/systemd/system/cloudsecure-agent.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2024-04-26 02:50:37 EDT; 12h ago
 Main PID: 15887 (java)
    Tasks: 72
   CGroup: /system.slice/cloudsecure-agent.service
           ├─15887 java -Dconfig.file=/test_user/apps/cloudsecure/agent/conf/application.conf -Dagent.proxy.host= -Dagent.proxy.port= -Dagent.proxy.user= -Dagent.proxy.password= -Dagent.env=prod -Dagent.base.path=/test_user/apps/cloudsecure/agent -...

----
. O agente deve estar visível na página “Agentes” e deve estar no estado “conectado”.
+
image:ws_agentsPageShowingConnected.png["IU mostrando agentes conectados"]

+
.. Limpeza pós-instalação.


. Se a instalação do agente for bem-sucedida, os arquivos do instalador do agente baixados poderão ser excluídos.




== Instalando um novo coletor de dados.

Nota: Este documento contém instruções para instalar o “coletor de dados ONTAP SVM”.  As mesmas etapas se aplicam ao “Coletor de dados Cloud Volumes ONTAP ” e ao “Coletor de dados Amazon FSx for NetApp ONTAP ”.

. Vá para o sistema no qual o coletor precisa ser instalado e crie um diretório chamado _./tmp/collectors_ no diretório _caminho de instalação do agente_.
+
Observação: se o agente estiver instalado em _/opt/netapp_, navegue até _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. Altere recursivamente a propriedade do diretório _tmp_ para *cssys:cssys* (o usuário e o grupo cssys serão criados durante a instalação do agente).
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. Agora precisamos buscar a versão do coletor e o UUID do coletor.  Navegue até a API “cloudsecure_config.collector-types”.
. Acesse o Swagger, API “cloudsecure_config.collector-types > /v1/cloudsecure/collector-types” (GET).  No menu suspenso “collectorCategory”, selecione o tipo de coletor como “DATA”.  Selecione “TODOS” para buscar todos os detalhes do tipo de coletor.
. Copie o UUID do tipo de coletor necessário.
+
image:ws_collectorAPIShowingUUID.png["Resposta da API do coletor mostrando UUID"]

. Baixe o instalador do coletor.
+
.. Navegue até a API “cloudsecure_installers.collector > /v1/cloudsecure/collector-types/installers/{collectorTypeUUID}” (GET).  Digite o UUID copiado da etapa anterior e baixe o arquivo do instalador.
+
image:ws_downloadCollectorByUUID.png["API para baixar o coletor por UUID"]

.. Se o arquivo do instalador for baixado externamente em uma máquina diferente, copie o arquivo do instalador para o sistema onde o agente está sendo executado e coloque-o no diretório _/{agent-install-path}/cloudsecure/tmp/collectors_.
.. Como alternativa, você pode copiar o comando curl da mesma API e executá-lo diretamente no sistema onde o coletor será instalado.
+
Observe que o nome do arquivo deve ser o mesmo presente nos cabeçalhos de resposta da API do coletor de downloads. Veja a captura de tela abaixo.

+
Observação: se o agente estiver instalado em _/opt/netapp_, navegue até _/opt/netapp/cloudsecure/tmp/collectors_.

+
image:ws_curl_command.png["Exemplo de comando Curl mostrando token ofuscado"]

+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/1829df8a-c16d-45b1-b72a-ed5707129870" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ontap-dsc_1.286.0.zip
----


. Alterar a propriedade do arquivo zip do instalador do coletor para *cssys:cssys*.
+
[listing]
----
-rw------- 1 root root 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# ll
total 49716
-rw------- 1 cssys cssys 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
----
. Navegue até *Segurança de carga de trabalho > Coletores* e selecione *+Coletor*.  Escolha o coletor _ONTAP SVM_.
. Configure os detalhes do coletor e _Salve_ o coletor.
. Ao clicar em _Salvar_, o processo do agente localizará o instalador do coletor no diretório _/{agent-install-path}/cloudsecure/tmp/collectors/_ e instalará o coletor.
. Como opção alternativa, em vez de adicionar o coletor via interface do usuário, ele também pode ser adicionado via API.
+
.. Navegue até “cloudsecure_config.collectors” > “/v1/cloudsecure/collectors” (POST) API.
.. No menu suspenso de exemplo, selecione “amostra json do coletor de dados ONTAP SVM”, atualize os detalhes de configuração do coletor e execute.
+
image:ws_API_add_collector.png["API para adicionar coletor"]



. O coletor agora deve estar visível na seção "Coletores de dados".
+
image:ws_collectorPageList.png["Página de lista da IU mostrando coletores"]

. Limpeza pós-instalação.
+
.. Se a instalação do coletor for bem-sucedida, todos os arquivos no diretório _/{agent-install-path}/cloudsecure/tmp/collectors_ poderão ser excluídos.






== Instalando um novo coletor de diretório de usuário

Observação: neste documento mencionamos as etapas para instalar um coletor LDAP.  As mesmas etapas se aplicam à instalação de um coletor de AD.

. 1. Vá para o sistema no qual o coletor precisa ser instalado e crie um diretório chamado _./tmp/collectors_ no diretório _caminho de instalação do agente_.
+
Observação: se o agente estiver instalado em _/opt/netapp_, navegue até _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
+
.. Alterar a propriedade do diretório _collectors_ para *cssys:cssys*
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp

[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors

----


. Agora precisamos buscar a versão e o UUID do coletor.  Navegue até a API “cloudsecure_config.collector-types”.  No menu suspenso collectorCategory, selecione o tipo de coletor como “USUÁRIO”.  Selecione “TODOS” para buscar todos os detalhes do tipo de coletor em uma única solicitação.
+
image:ws_API_collector_all.png["API para obter todos os coletores"]

. Copie o UUID do coletor LDAP.
+
image:ws_LDAP_collector_UUID.png["Resposta da API mostrando o UUID do coletor LDAP"]

. Baixe o instalador do coletor.
+
.. Navegue até “cloudsecure_installers.collector” > “/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}” (GET) API.  Digite o UUID copiado da etapa anterior e baixe o arquivo do instalador.
+
image:ws_LDAP_collector_UUID_download.png["API e resposta ao coletor de download"]

.. Se o arquivo do instalador for baixado externamente em uma máquina diferente, copie o arquivo do instalador para o sistema onde o agente está em execução e no diretório _/{agent-installation-path}/cloudsecure/tmp/collectors_.
.. Como alternativa, você pode copiar o comando curl da mesma API e executá-lo diretamente no sistema onde o coletor deve ser instalado.
+
Observe que o nome do arquivo deve ser o mesmo presente nos cabeçalhos de resposta da API do coletor de downloads. Veja a captura de tela abaixo.

+
Observe também que se o agente estiver instalado em _/opt/netapp_, navegue até _/opt/netapp/cloudsecure/tmp/collectors_.

+
image:ws_curl_command.png["API de comando curl"]



+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/37fb37bd-6078-4c75-a64f-2b14cb1a1eb1" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ldap-dsc_1.322.0.zip
----
. Alterar a propriedade do arquivo zip do instalador do coletor para cssys:cssys.
+
[listing]
----
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 root root 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 cssys cssys 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip

----
. Navegue até a página 'Coletores de diretório de usuários' e clique em '+ Coletor de diretório de usuários'.
+
image:ws_user_directory_collector.png["Adicionando coletor de diretório de usuário"]

. Selecione 'Servidor de diretório LDAP'.
+
image:ws_LDAP_user_select.png["Janela da interface do usuário para selecionar um usuário LDAP"]

. Insira os detalhes do servidor de diretório LDAP e clique em "Salvar"
+
image:ws_LDAP_user_Details.png["IU mostrando detalhes do usuário LDAP"]

. Ao clicar em _Salvar_, o serviço do agente localizará o instalador do coletor no diretório _/{agent-install-path}/cloudsecure/tmp/collectors/_ e instalará o coletor.
. Como opção alternativa, em vez de adicionar o coletor via interface do usuário, ele também pode ser adicionado via API.
+
.. Navegue até “cloudsecure_config.collectors” > “/v1/cloudsecure/collectors” (POST) API.
.. No menu suspenso de exemplo, selecione “LDAP Directory Server user collector json sample”, atualize os detalhes de configuração do coletor e clique em “Execute”.
+
image:ws_API_LDAP_Collector.png["API para coletor LDAP"]



. O coletor agora deve estar visível na seção “Coletores de diretório do usuário”.
+
image:ws_LDAP_collector_list.png["Lista de coletores LDAP na interface do usuário"]

. Limpeza pós-instalação.
+
.. Se a instalação do coletor for bem-sucedida, todos os arquivos no diretório _/{agent-install-path}/cloudsecure/tmp/collectors_ poderão ser excluídos.






== Atualizando um agente

Uma notificação por e-mail será enviada quando uma nova versão do agente/coletor estiver disponível.

. Baixe o instalador do agente mais recente.
+
.. As etapas para baixar o instalador mais recente são semelhantes às de “Instalando um novo agente”.  No swagger, selecione “cloudsecure_installers.agent” > API “/v1/cloudsecure/agents/installers/{platform}/latest”, insira a plataforma como “linux” e baixe o arquivo zip do instalador.  Alternativamente, um comando curl também pode ser usado.  Descompacte o arquivo do instalador.


. Defina permissão de execução para o arquivo “cloudsecure-agent-upgrade.sh”.
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.618.0.zip
Archive:  cloudsecure-linux-agent-installer-1.618.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rwx------ 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip

----
. Execute o script “cloudsecure-agent-upgrade.sh”.  Se o script tiver sido executado com sucesso, ele imprimirá a mensagem “O agente Cloudsecure foi atualizado com sucesso” na saída.
. Execute o seguinte comando 'systemctl daemon-reload'
+
[listing]
----
[root@demo-agent ~]# systemctl daemon-reload
----
. Reinicie o serviço do agente.
+
[listing]
----
[root@demo-agent ~]# systemctl restart cloudsecure-agent.service
----
+
Neste ponto, o agente deve ser atualizado com sucesso.

. Verificação de integridade após atualização do agente.
+
.. Navegue até o caminho onde o agente está instalado (por exemplo, “/opt/netapp/cloudsecure/”).  O link simbólico “agente” deve apontar para a nova versão do agente.
+
[listing]
----
[root@demo-agent cloudsecure]# pwd
/opt/netapp/cloudsecure
[root@demo-agent cloudsecure]# ll
total 40
lrwxrwxrwx  1 cssys cssys  114 Apr 26 17:38 agent -> /test_user/apps/cloudsecure/cloudsecure-agent-1.618.0
drwxr-xr-x  4 cssys cssys 4096 Apr 25 10:45 agent-certs
drwx------  2 cssys cssys 4096 Apr 25 16:18 agent-logs
drwx------ 11 cssys cssys 4096 Apr 26 02:50 cloudsecure-agent-1.617.0
drwx------ 11 cssys cssys 4096 Apr 26 17:42 cloudsecure-agent-1.618.0
drwxr-xr-x  3 cssys cssys 4096 Apr 26 02:45 collector-image
drwx------  2 cssys cssys 4096 Apr 25 10:45 conf
drwx------  3 cssys cssys 4096 Apr 26 16:39 data-collectors
-rw-r--r--  1 root  root    66 Apr 25 10:45 sysctl.conf.bkp
drwx------  2 root  root  4096 Apr 26 17:38 tmp

----
.. O agente deve estar visível na página “Agentes” e deve estar no estado “conectado”.
+
image:ws_agentsPageShowingConnected.png["IU mostrando agentes conectados"]



. Limpeza pós-instalação.
+
.. Se a instalação do agente for bem-sucedida, os arquivos do instalador do agente baixados poderão ser excluídos.






== Atualizando coletores

Observação: as etapas de atualização são as mesmas para todos os tipos de coletores.  Neste documento demonstraremos a atualização do coletor “ONTAP SVM”.

. Vá para o sistema no qual os coletores precisam ser atualizados e crie o diretório _./tmp/collectors_ no diretório _caminho de instalação do agente_, se ele ainda não estiver presente.
+
Observação: se o agente estiver instalado em _/opt/netapp_, navegue até o diretório _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. Certifique-se de que o diretório “coletores” seja de propriedade de _cssys:cssys_.
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. No swagger, navegue até “cloudsecure_config.collector-types” GET API.  No menu suspenso “collectorCategory”, selecione “DATA” (selecione “USER” para o coletor de diretório de usuário ou “ALL”).
+
Copie o UUID e a versão do corpo da resposta.

+
image:ws_collector_uuid_and_version.png["Resposta da API mostrando o UUID do coletor e a versão destacados"]

. Baixe o arquivo mais recente do instalador do coletor.
+
.. Navegue até _cloudsecure_installers.collector_ > _/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}_ API.  Digite _collectorTypeUUID_ copiado da etapa anterior.  Baixe o instalador no diretório _/{agent-install-path}/cloudsecure/tmp/collectors_.
.. Alternativamente, o comando curl da mesma API também pode ser usado.
+
image:ws_curl_command_only.png["Exemplo de comando curl"]

+
Observação: o nome do arquivo deve ser o mesmo presente nos cabeçalhos de resposta da API do coletor de downloads.



. Alterar a propriedade do arquivo zip do instalador do coletor para cssys:cssys.
+
[listing]
----
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 root root 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 cssys cssys 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip

----
. Acionar a API do coletor de atualização.
+
.. No swagger, navegue até “cloudsecure_installers.collector” > “/v1/cloudsecure/collector-types/upgrade” (PUT) API.
.. No menu suspenso “Exemplos”, selecione “Amostra JSON de atualização do coletor de dados ONTAP SVM” para preencher a carga útil de amostra.
.. Substituir versão pela versão copiada de<<copy-access-token,Passo 3>> e clique em "Executar".
+
image:ws_svm_ontap_collector_upgrade_example_json.png["Exemplo de atualização do SVM na interface do usuário do Swagger"]

+
Aguarde alguns segundos.  Os colecionadores serão atualizados automaticamente.



. Verificação de sanidade.
+
Os coletores devem estar em estado de execução na interface do usuário.

. Limpeza pós-atualização:
+
.. Se a atualização do coletor for bem-sucedida, todos os arquivos no diretório _/{agent-install-path}/cloudsecure/tmp/collectors_ poderão ser excluídos.




Repita os passos acima para atualizar outros tipos de coletores também.



== Problemas e correções do Commons.

. Erro AGENT014
+
Este erro ocorrerá se o arquivo do instalador do coletor não estiver presente no diretório _/{agent-install-path}/cloudsecure/tmp/collectors_ ou não estiver acessível.  Certifique-se de que o arquivo do instalador foi baixado e que a estrutura completa do diretório _collectors_ e o arquivo zip do instalador são de propriedade de cssys:cssys. Em seguida, reinicie o serviço do agente: _systemctl restart cloudsecure-agent.service_.

+
image:ws_agent014_error.png["Tela da interface do usuário mostrando a dica de erro \"agente 014\""]

. Erro não autorizado
+
[listing]
----
{
  "errorMessage": "Requested public API is not allowed to be accessed by input API access token.",
  "errorCode": "NOT_AUTHORIZED"
}

----
+
Este erro será exibido se o token de acesso à API for gerado sem selecionar todas as categorias de API necessárias.  Gere um novo token de acesso à API selecionando todas as categorias de API necessárias.


